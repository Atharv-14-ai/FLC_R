<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Return Entry - FLC Tracking</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    {% include 'navbar.html' %}

    <div class="container mt-5">
      <h3 class="text-primary mb-4">Return Entry</h3>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <div class="card shadow p-4 mb-4">
        <form method="POST" action="{{ url_for('returns') }}">
          <div class="mb-3">
            <label class="form-label fw-bold">Select Dispatch</label>
              <select name="dispatch_id" class="form-select" required>
    <option value="" disabled selected>-- Select a Dispatch --</option>
    {% for d in dispatches %}
      <option value="{{ d.id }}" {% if d.remaining == 0 %}disabled{% endif %}>
        ID {{ d.id }} â€” {{ d.component or 'N/A' }} | To: {{
        d.receiver_name if d.receiver_name else d.to_role }}
        | Sent: {{ d.flc_qty }} | Returned: {{ d.total_returned }} | Remaining: {{ d.remaining }}
        {% if d.remaining == 0 %} (Completed){% endif %}
      </option>
    {% endfor %}
  </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">FLC Quantity Returned</label>
            <input
              type="number"
              name="flc_qty"
              class="form-control"
              min="1"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Remarks (optional)</label>
            <input type="text" name="remarks" class="form-control" />
          </div>

          <button type="submit" class="btn btn-primary w-100">
            Record Return
          </button>
        </form>
      </div>

      <h4 class="text-light mt-5">All Returns</h4>
      <div class="table-responsive">
        <table class="table table-bordered table-hover table-striped">
          <thead class="table-primary">
            <tr>
              <th>ID</th>
              <th>Dispatch ID</th>
              <th>FLC Qty</th>
              <th>Remarks</th>
              <th>Date/Time</th>
            </tr>
          </thead>
          <tbody>
            {% for r in returns %}
            <tr>
              <td>{{ r.id }}</td>
              <td>{{ r.dispatch_id }}</td>
              <td>{{ r.flc_qty }}</td>
              <td>{{ r.remarks }}</td>
              <td>
                {{ r.date_time.strftime('%Y-%m-%d %H:%M:%S') if r.date_time else
                '' }}
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center text-muted">
                No returns recorded yet.
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
