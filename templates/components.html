{% extends "base.html" %}
{% block content %}
<div class="container mt-4" data-aos="fade-up">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="gradient-text mb-2">Manage Components & Stock</h2>
      <p class="text-muted">Manage your FLC components and inventory levels</p>
    </div>
    <a href="{{ url_for('add_component') }}" class="btn btn-primary">
      <i class="bi bi-plus-circle me-2"></i>Add New Component
    </a>
  </div>

  {% if components|length == 0 %}
  <div class="card text-center py-5" data-aos="zoom-in">
    <div class="card-body">
      <i class="bi bi-inboxes display-1 text-muted mb-3"></i>
      <h4 class="text-muted">No Components Added Yet</h4>
      <p class="text-muted mb-4">Start by adding your first component to the system</p>
      <a href="{{ url_for('add_component') }}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-circle me-2"></i>Add First Component
      </a>
    </div>
  </div>
  {% else %}
  <div class="card shadow-sm border-0" data-aos="fade-up">
    <div class="card-header bg-transparent border-0 py-3">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h5 class="mb-0 text-dark">
            <i class="bi bi-grid-3x3-gap me-2 text-primary"></i>
            Components Overview
          </h5>
        </div>
        <div class="col-md-6 text-md-end">
          <span class="badge bg-primary fs-6">{{ components|length }} components</span>
        </div>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">ID</th>
              <th>Component Name</th>
              <th>Description</th>
              <th class="text-center">Stock Qty</th>
              <th>Created Date</th>
              <th class="text-center pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for comp in components %}
            <tr class="align-middle" data-aos="fade-right" data-aos-delay="{{ loop.index * 50 }}">
              <td class="ps-4 fw-semibold text-primary">#{{ comp.id }}</td>
              <td>
                <div class="d-flex align-items-center">
                  <div class="bg-primary bg-opacity-10 rounded p-2 me-3">
                    <i class="bi bi-cpu text-primary"></i>
                  </div>
                  <span class="fw-semibold text-dark">{{ comp.name }}</span>
                </div>
              </td>
              <td>
                <span class="text-muted">{{ comp.description or 'No description' }}</span>
              </td>
              <td class="text-center">
                <span class="badge {% if comp.flc_stock > 50 %}bg-success{% elif comp.flc_stock > 20 %}bg-warning{% else %}bg-danger{% endif %} fs-6 px-3 py-2">
                  {{ comp.flc_stock }} units
                </span>
              </td>
              <td>
                <small class="text-muted">{{ comp.created_at.strftime("%d %b %Y") }}</small>
              </td>
              <td class="text-center pe-4">
                <div class="btn-group" role="group">
                  <!-- Edit button -->
                  <a
                    href="{{ url_for('edit_component', id=comp.id) }}"
                    class="btn btn-outline-primary btn-sm"
                    data-bs-toggle="tooltip"
                    title="Edit Component"
                  >
                    <i class="bi bi-pencil-square me-1"></i>Edit
                  </a>

                  <!-- Delete form -->
                  <form
                    action="{{ url_for('delete_component', component_id=comp.id) }}"
                    method="POST"
                    class="d-inline"
                    onsubmit="return confirmDelete(event)"
                  >
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button 
                      type="submit" 
                      class="btn btn-outline-danger btn-sm"
                      data-bs-toggle="tooltip"
                      title="Delete Component"
                    >
                      <i class="bi bi-trash me-1"></i>Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-footer bg-transparent border-0 py-3">
      <div class="row">
        <div class="col-md-6">
          <small class="text-muted">
            Showing {{ components|length }} component{{ 's' if components|length != 1 }}
          </small>
        </div>
        <div class="col-md-6 text-md-end">
          {% set total_stock = components|sum(attribute='flc_stock') %}
          <small class="text-muted">
            Total Stock: <strong>{{ total_stock }} units</strong>
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="row mt-4" data-aos="fade-up" data-aos-delay="200">
    <div class="col-md-3">
      <div class="stat-card">
        <div class="d-flex align-items-center">
          <div class="bg-primary bg-opacity-10 rounded p-3 me-3">
            <i class="bi bi-grid-3x3-gap text-primary fs-4"></i>
          </div>
          <div>
            <h4 class="mb-0 text-dark">{{ components|length }}</h4>
            <small class="text-muted">Total Components</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="d-flex align-items-center">
          <div class="bg-success bg-opacity-10 rounded p-3 me-3">
            <i class="bi bi-box-seam text-success fs-4"></i>
          </div>
          <div>
            <h4 class="mb-0 text-dark">{{ components|sum(attribute='flc_stock') }}</h4>
            <small class="text-muted">Total Stock</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="d-flex align-items-center">
          <div class="bg-info bg-opacity-10 rounded p-3 me-3">
            <i class="bi bi-graph-up text-info fs-4"></i>
          </div>
          <div>
            <h4 class="mb-0 text-dark">{{ (components|max(attribute='flc_stock')).flc_stock if components else 0 }}</h4>
            <small class="text-muted">Max Stock</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card">
        <div class="d-flex align-items-center">
          <div class="bg-warning bg-opacity-10 rounded p-3 me-3">
            <i class="bi bi-graph-down text-warning fs-4"></i>
          </div>
          <div>
            <h4 class="mb-0 text-dark">{{ (components|min(attribute='flc_stock')).flc_stock if components else 0 }}</h4>
            <small class="text-muted">Min Stock</small>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
function confirmDelete(event) {
  event.preventDefault();
  const form = event.target;
  
  Swal.fire({
    title: 'Are you sure?',
    text: "This component will be permanently deleted!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Yes, delete it!',
    cancelButtonText: 'Cancel',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      form.submit();
    }
  });
  
  return false;
}

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
});
</script>

<!-- SweetAlert2 for better confirmations -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
.table tbody tr {
  transition: all 0.3s ease;
}

.table tbody tr:hover {
  background: rgba(37, 99, 235, 0.04) !important;
  transform: translateX(4px);
}

.btn-group .btn {
  border-radius: 8px !important;
  margin: 0 2px;
}

.badge {
  font-size: 0.75rem !important;
}
</style>
{% endblock %}